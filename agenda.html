<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>RealMind ‚Äî Agenda M√©dica</title>
<style>
:root { --bg:#E6F0FA; --ink:#2D3E50; --accent:#9C8DF0; }
body{margin:0;font-family:Arial,system-ui,sans-serif;background:var(--bg);color:var(--ink)}
header{padding:18px;text-align:center}
.card{width:min(92vw,720px);margin:0 auto;background:#fff;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.1)}
input,textarea,select{width:100%;padding:12px;border-radius:12px;border:1px solid #cbd5e1;margin:6px 0;font-size:16px}
.btn{display:inline-block;margin:6px 4px;padding:12px 16px;border-radius:12px;background:var(--accent);color:#fff;text-decoration:none;font-weight:700;border:none;cursor:pointer}
.item{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:#f8fafc;margin:8px 0}
small{opacity:.75}
.badge{background:#ede9fe;color:#5b21b6;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:700}
.row{display:grid;grid-template-columns:1fr 180px;gap:8px}
@media(max-width:480px){ .row{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <h1 style="margin:0">üìÖ Agenda M√©dica</h1>
  <p style="margin:4px 0 0;opacity:.8">Lembretes de rem√©dios e consultas ‚Äî tudo salvo no seu aparelho</p>
</header>

<div class="card">
  <form id="form">
    <label>T√≠tulo (rem√©dio, consulta, etc.)</label>
    <input id="titulo" placeholder="Ex.: Risperidona 2 mg / Consulta psiquiatra">
    <div class="row">
      <div>
        <label>Data e hora</label>
        <input id="quando" type="datetime-local">
      </div>
      <div>
        <label>Repetir</label>
        <select id="repeat">
          <option value="none">N√£o repetir</option>
          <option value="daily">Diariamente</option>
          <option value="weekly">Semanalmente</option>
        </select>
      </div>
    </div>
    <label>Observa√ß√µes</label>
    <textarea id="obs" rows="3" placeholder="Ex.: tomar ap√≥s o caf√©, levar receita, etc."></textarea>
    <button class="btn" type="submit">Adicionar</button>
    <button class="btn" type="button" id="perm">Permitir Notifica√ß√µes</button>
    <a class="btn" style="background:#64748b" href="menu.html">‚¨ÖÔ∏è Menu</a>
  </form>
</div>

<div class="card" style="margin-top:14px">
  <h3 style="margin:0 0 8px">Meus lembretes</h3>
  <div id="lista"></div>
</div>

<script>
const $ = (id)=>document.getElementById(id);
const STORAGE_KEY = "rm_agenda";
const NOTIFIED_KEY = "rm_agenda_notified";

let agenda = JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
let notified = JSON.parse(localStorage.getItem(NOTIFIED_KEY)||"{}");

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(agenda));
  localStorage.setItem(NOTIFIED_KEY, JSON.stringify(notified));
}

function uid(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); }

function render(){
  const wrap = $("lista");
  if(agenda.length===0){ wrap.innerHTML = '<small>Sem lembretes ainda.</small>'; return; }
  wrap.innerHTML = agenda.sort((a,b)=> new Date(a.quando)-new Date(b.quando)).map(item => {
    const dt = new Date(item.quando);
    const due = dt.toLocaleString();
    return \`
      <div class="item">
        <div>
          <div style="font-weight:700">\${item.titulo} \${item.done?'<span class="badge">Conclu√≠do</span>':''}</div>
          <small>\${due} ‚Ä¢ \${item.repeat==='daily'?'Di√°rio': item.repeat==='weekly'?'Semanal':''}</small>
          \${item.obs ? '<div><small>'+item.obs+'</small></div>' : ''}
        </div>
        <div>
          <button class="btn" onclick="toggleDone('\${item.id}')">\${item.done ? 'Refazer' : 'Concluir'}</button>
          <button class="btn" style="background:#ef4444" onclick="delItem('\${item.id}')">Excluir</button>
        </div>
      </div>\`;
  }).join("");
}

$("form").addEventListener("submit", (e)=>{
  e.preventDefault();
  const titulo = $("titulo").value.trim();
  const quando = $("quando").value;
  const obs = $("obs").value.trim();
  const repeat = $("repeat").value;
  if(!titulo || !quando){ alert("Preencha t√≠tulo e data/hora."); return; }
  agenda.push({ id: uid(), titulo, quando, obs, repeat, done:false });
  $("titulo").value = ""; $("quando").value = ""; $("obs").value = "";
  save(); render();
});

function delItem(id){
  agenda = agenda.filter(x=>x.id!==id);
  delete notified[id];
  save(); render();
}

function toggleDone(id){
  const it = agenda.find(x=>x.id===id);
  if(!it) return;
  it.done = !it.done;
  save(); render();
}

// Notifica√ß√µes
$("perm").onclick = async ()=>{
  if(!("Notification" in window)){ alert("Seu navegador n√£o suporta notifica√ß√µes."); return; }
  const p = await Notification.requestPermission();
  alert(p==="granted" ? "Notifica√ß√µes ativadas." : "Permiss√£o negada.");
};

function maybeNotify(){
  const now = Date.now();
  agenda.forEach(item=>{
    if(item.done) return;
    const t = new Date(item.quando).getTime();
    if(Math.abs(now - t) < 60*1000){ // dentro de 1 minuto
      if(!notified[item.id] && "Notification" in window && Notification.permission==="granted"){
        new Notification("RealMind", { body: "üíä "+item.titulo, icon:"icon-192.png" });
      }
      notified[item.id] = true;
      // Repeti√ß√£o
      if(item.repeat==='daily'){
        item.quando = new Date(t + 24*60*60*1000).toISOString().slice(0,16);
        delete notified[item.id];
      } else if(item.repeat==='weekly'){
        item.quando = new Date(t + 7*24*60*60*1000).toISOString().slice(0,16);
        delete notified[item.id];
      }
      save(); render();
    }
  });
}

setInterval(maybeNotify, 15000);
render();
</script>
</body>
</html>
